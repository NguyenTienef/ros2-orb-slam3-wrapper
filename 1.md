# ORB-SLAM3 Architecture

## 1. Overall System Pipeline

```
        ┌─────────────────────────┐
        │        Sensors          │
        │  Camera / IMU / LiDAR   │
        └───────────┬─────────────┘
                    │
                    ▼
        ┌─────────────────────────┐
        │        Front-end        │
        │  • Feature Extraction   │
        │  • Feature Matching     │
        │  • Outlier Rejection    │
        │  • Motion Estimation    │
        └───────────┬─────────────┘
                    │  Observations
                    ▼
        ┌─────────────────────────┐
        │        Back-end         │
        │  • State Graph          │
        │  • Bundle Adjustment    │
        │  • Pose Graph Opt       │
        │  • Nonlinear Optimizer  │
        └───────┬─────────┬───────┘
                │         │
                │         │
                ▼         ▼
    ┌────────────────┐  ┌───────────────────┐
    │   Local Map    │  │   Global Map      │
    │  • Keyframes   │  │ • Optimized graph │
    │  • Landmarks   │  │                   │
    └────────────────┘  └───────────────────┘
                ▲
                │
        ┌───────┴───────────┐
        │   Loop Closing    │
        │  • Place Recog    │
        │  • Loop Detection │
        │  • Add Constraints│
        │  • Global Opt     │
        └───────────────────┘
```

---

## 2. Multi-Threading Architecture

Three main threads work concurrently to enable real-time SLAM:

### Thread 1: Tracking (Front-end)
Runs at frame rate, estimates camera motion in real-time
```
Sensor → Feature → Matching → Pose Estimation
                    │
                    ▼
              Keyframe Decision
                    │
                    ▼
              Send to Back-end
```

### Thread 2: Local Mapping (Back-end)
Optimizes recent keyframes and updates the local map
```
Keyframe → Local BA → Update Map
                    │
                    ▼
              Send constraints
```

### Thread 3: Loop Closing
Detects loop closures and performs global optimization
```
Keyframe → Place Recognition
            │
       Loop Detected?
            │
            ▼
    Pose Graph Optimization
```

---

## 3. Map Management System

Hierarchical map structure for handling multiple maps and relocalization:

```
     ┌────────────────────┐
     │  Map Management    │
     │  • Multi-map       │
     │  • Map Merge       │
     │  • Relocalization  │
     └─────────┬──────────┘
               │
               ▼
      ┌──────────────────┐
      │   Active Map     │
      └──────────────────┘
```

---

## Component Descriptions

| Component | Responsibility |
|-----------|---|
| **Front-end** | Real-time sensor processing, feature extraction, and camera pose estimation |
| **Back-end** | Graph optimization, bundle adjustment, and local map updates |
| **Loop Closing** | Place recognition, loop detection, and global pose graph optimization |
| **Local Map** | Stores recent keyframes and landmarks for local optimization and testing |
| **Global Map** | Maintains the globally optimized graph structure and pose history |
| **Map Management** | Handles multi-map scenarios, map merging, and relocalization between maps |

---

## Processing Flow

1. **Input**: Sensor data from camera, IMU, or LiDAR
2. **Front-end**: Extract and match features, estimate camera pose
3. **Keyframe Decision**: Determine if frame is significant
4. **Back-end**: Optimize map using new keyframe observations
5. **Loop Closing**: Detect revisited places and add global constraints
6. **Output**: Accurate 3D map and camera trajectory
